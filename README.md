# Gloamreach — StoryWorld

**Gloamreach** is a dark‑fantasy interactive story built with [Streamlit](https://streamlit.io) and OpenAI’s chat models. It generates narrative scenes and choices on the fly, tracking your decisions and their consequences across sessions. The game is designed to be middle‑school friendly (PG‑13) but still evokes a grim, mysterious world where magic comes at a cost.

---

## Features

- **Dynamic storytelling** — Narrative generated by OpenAI, guided by detailed lore in `lore.json`.
- **Player choices** — Each turn, you receive two imperative options, with consequences.
- **Risk & death system** — Tracks dangerous decisions and escalates peril; risky streaks can lead to character death.
- **Persistent sessions** — Player progress is stored in SQLite by default, or PostgreSQL/Neon if configured.
- **Custom UI** — Streamlit‑based frontend with animations, a lantern loader, and typewriter‑style text reveal.
- **Telemetry & logging** — Choice latency, danger streaks, and outcomes are recorded for analysis.

---

## Agile Roadmap: Toward a Choose‑Your‑Own‑Adventure Arc

This roadmap layers a loose, pre‑defined arc (beginning → middle → end) on top of the existing branching engine.

### Phase 1 — Foundations

1. **Define critical beats**: Draft an arc (Exposition, Rising Action, Climax, Falling Action, Resolution).
2. **Extend session state**: Add a `current_beat` variable to track the narrative phase.
3. **Update prompts**: Create prompt templates for each beat, tuned for tone and pacing.

### Phase 2 — Exposition & Onboarding

1. **Intro scenes**: Provide 1–3 introductory scenes that establish setting and the inciting incident.
2. **Branching**: Allow light exploration, but always converge on the inciting incident.

### Phase 3 — Rising Action Mechanics

1. **Risk escalation**: Tie existing risk/death counters to `rising_action` prompts.
2. **Scene count**: Implement 4–6 rising action scenes that escalate conflict.
3. **State triggers**: Progress to climax when thresholds are met (e.g., scene count, risky decisions, narrative milestone).

### Phase 4 — Climax Implementation

1. **Funnel logic**: Converge all branches on a pivotal confrontation.
2. **Outcome variation**: Modify climax scenes based on allies, health, or state flags.
3. **High stakes**: Risk/death mechanic is most punishing here.

### Phase 5 — Falling Action

1. **Aftermath scenes**: Add 1–2 scenes reflecting the consequences of climax choices.
2. **Branch reactivity**: Personalize consequences (e.g., town saved or doomed).

### Phase 6 — Resolution / Denouement

1. **Wrap‑up**: Provide 1–2 concluding scenes summarizing the journey.
2. **Replayability**: End with an invitation to restart with different choices.

### Phase 7 — Testing & Iteration

1. **Playtest arcs**: Ensure pacing yields \~8–12 scenes per playthrough.
2. **Telemetry checks**: Verify beat transitions and branch variety.
3. **Refine prompts**: Adjust per‑beat narrative tone and style.

---

## Getting Started

### Prerequisites

- Python 3.9+
- [Streamlit](https://streamlit.io/)
- OpenAI API key

Install dependencies:

```bash
pip install -r requirements.txt
```

### Running the Game

```bash
streamlit run app.py
```

Once launched, the app will open in your browser. Players can enter their name, gender, and archetype before starting a new adventure in Gloamreach.

---

## Project Structure

```
StoryWorld/
├── app.py              # Main Streamlit app entry point
├── lore.json           # Defines game lore, factions, locations, relics
├── prompts.py          # Templates for system & user prompts
├── core/               # Identity management, logging
├── story/engine.py     # Story generation & choice logic
├── ui/                 # CSS, streaming, loader, and choice rendering
├── data/               # SQLite & Neon database storage backends
├── scripts/            # Dev/testing scripts (e.g., DB smoke test)
└── utils/              # Retry logic and helpers
```

---

## Database Persistence

- **Default:** SQLite database stored locally as `story.db`.
- **Optional:** Neon/Postgres by setting a `DATABASE_URL` environment variable.

Progress is stored in tables for `story_progress`, `story_visits`, and `story_events`.

---

## Customization

- **Lore:** Modify `lore.json` to change the world, factions, and rules.
- **Prompts:** Tweak `prompts.py` to alter narrative tone or structure.
- **UI:** Adjust styles in `ui/anim.py` or extend with new components.

---

## License

This project is released under the MIT License. See [LICENSE](LICENSE) for details.

